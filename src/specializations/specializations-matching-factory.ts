import path from 'path';
import fs from 'fs/promises';
import { SpecializationsMatchingEngine, type WordSynonym, type WordWeight } from './specializations-matching-engine';

export class SpecializationsMatchingFactory {
    public static async create(): Promise<SpecializationsMatchingEngine> {
        const csvPath = path.resolve(process.cwd(), 'data/specializations/specializations.csv');
        const fileContent = await fs.readFile(csvPath, 'utf-8');

        const specNames = fileContent
            .split('\n')
            .map(line => line.trim())
            .filter(line => line && line !== '"–ù–∞–∑–≤–∞–Ω–∏–µ"')
            .map(line => line.replace(/^"(.*)"$/, '$1'));

        // Filtered and refined synonyms
        const synonymsData: WordSynonym[] = [
            { src: 'dev', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: 'manual', dst: '—Ä—É—á–Ω–æ–π' },
            { src: 'automation', dst: '–∞–≤—Ç–æ' },
            { src: 'director', dst: '–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { src: 'head', dst: '—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' },
            { src: 'cpo', dst: '–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { src: 'cto', dst: '–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { src: 'cio', dst: '–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { src: 'cdo', dst: '–¥–∏—Ä–µ–∫—Ç–æ—Ä' },
            { src: 'product', dst: '–ø—Ä–æ–¥—É–∫—Ç' },
            { src: 'project', dst: '–ø—Ä–æ–µ–∫—Ç' },
            { src: 'delivery', dst: '–¥–µ–ª–∏–≤–µ—Ä–∏' },
            { src: 'teamlead', dst: '—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' },
            { src: 'team', dst: null },
            { src: 'senior', dst: null },
            { src: 'middle', dst: null },
            { src: 'junior', dst: null },
            { src: 'staff', dst: null },
            { src: 'principal', dst: null },
            { src: 'expert', dst: null },
            { src: 'specialist', dst: null },
            { src: '–≥–ª–∞–≤–Ω—ã–π', dst: null },
            { src: '–≤–µ–¥—É—â–∏–π', dst: null },
            { src: '—Å—Ç–∞—Ä—à–∏–π', dst: null },
            { src: '–Ω–∞—á–∞–ª—å–Ω–∏–∫', dst: null },
            { src: '–∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å', dst: null },
            { src: '–∑–∞–º', dst: null },
            { src: '1c', dst: '1—Å' },
            { src: 'pm', dst: '–ø—Ä–æ–µ–∫—Ç' },
            { src: 'hr', dst: '–ø–µ—Ä—Å–æ–Ω–∞–ª' },
            { src: 'recruit', dst: '—Ä–µ–∫—Ä—É—Ç–µ—Ä' },
            { src: 'legal', dst: '—é—Ä–∏—Å—Ç' },
            { src: 'lawyer', dst: '—é—Ä–∏—Å—Ç' },
            { src: 'accounting', dst: '–±—É—Ö–≥–∞–ª—Ç–µ—Ä' },
            { src: 'finan', dst: '—Ñ–∏–Ω–∞–Ω—Å' },
            { src: 'wms', dst: '—Å–∫–ª–∞–¥' },
            { src: '—Å–∫–ª–∞–¥', dst: '—Å–∫–ª–∞–¥' },
            { src: '–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥', dst: '–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥' },
            { src: 'performance', dst: '—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å' },
            { src: 'transformation', dst: '—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è' },
            { src: 'digital', dst: '—Ü–∏—Ñ—Ä–æ–≤–æ–π' },
            { src: 'data', dst: '–¥–∞—Ç–∞' },
            { src: 'ai', dst: '–∏–∏' },
            { src: 'ml', dst: '–∏–∏' },
            { src: 'vision', dst: '–∏–∏' },
            { src: 'cv', dst: '–∏–∏' },
            { src: 'unreal', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: 'unity', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: 'game', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: 'abap', dst: 'abap' },
            { src: 'basis', dst: 'basis' },
            { src: 'hcm', dst: 'hcm' },
            { src: 'ewm', dst: 'ewm' },
            { src: 'bw', dst: 'bw' },
            { src: 'mm', dst: 'mm' },
            { src: 'sd', dst: 'sd' },
            { src: 'pp', dst: 'pp' },
            { src: 'pi', dst: 'pi' },
            { src: 'po', dst: 'po' },
            { src: 'fi', dst: 'fi' },
            { src: 'co', dst: 'co' },
            { src: 'network', dst: '—Å–µ—Ç–µ–≤–æ–π' },
            { src: '—Å–∏—Å—Ç–µ–º–∞', dst: '—Å–∏—Å—Ç–µ–º–Ω—ã–π' },
            { src: 'system', dst: '—Å–∏—Å—Ç–µ–º–Ω—ã–π' },
            { src: 'administration', dst: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' },
            { src: 'administrator', dst: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' },
            { src: '–∞–¥–º–∏–Ω', dst: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' },
            { src: '–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', dst: '–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞' },
            { src: 'agile', dst: 'agile' },
            { src: 'coach', dst: '–∫–æ—É—á' },
            { src: '–ø–æ–¥–¥–µ—Ä–∂–∫–∞', dst: '–ø–æ–¥–¥–µ—Ä–∂–∫–∞' },
            { src: '—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ', dst: '—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ' },
            { src: 'tech', dst: '—Ç–µ—Ö' },
            { src: 'technical', dst: '—Ç–µ—Ö' },
            { src: '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π', dst: '—Ç–µ—Ö' },
            { src: '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π', dst: '–∏–Ω—Ñ–æ' },
            { src: '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', dst: '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å' },
            { src: 'security', dst: '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å' },
            { src: 'cyber', dst: '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å' },
            { src: 'cloud', dst: '–æ–±–ª–∞–∫–æ' },
            { src: 'sre', dst: 'sre' },
            { src: 'javascript', dst: 'javascript' },
            { src: 'js', dst: 'javascript' },
            { src: 'node', dst: 'nodejs' },
            { src: 'nodejs', dst: 'nodejs' },
            { src: 'nest', dst: 'nestjs' },
            { src: 'nestjs', dst: 'nestjs' },
            { src: 'ios', dst: 'ios' },
            { src: 'android', dst: 'android' },
            { src: '–º–æ–±–∏–ª—å–Ω—ã–π', dst: '–º–æ–±–∏–ª—å–Ω—ã–π' },
            { src: '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: '–∞–Ω–∞–ª–∏—Ç–∏–∫–∞', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: '–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: '–±–∏–∑–Ω–µ—Å', dst: '–±–∏–∑–Ω–µ—Å' },
            { src: '–ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π', dst: '–ø—Ä–æ–¥—É–∫—Ç' },
            { src: '–ø—Ä–æ–µ–∫—Ç–æ–≤', dst: '–ø—Ä–æ–µ–∫—Ç' },
            { src: '—Ç–∏–º–ª–∏–¥', dst: '—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' },
            { src: '—Ç–µ—Ö–ª–∏–¥', dst: '—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' },
            { src: '–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä', dst: '–∞–≤—Ç–æ' },
            { src: '–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ', dst: '–∞–≤—Ç–æ' },
            { src: 'dba', dst: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö' },
            { src: 'fintech', dst: null },
            { src: 'retail', dst: null },
            { src: 'bank', dst: null },
            { src: 'trading', dst: null },
            { src: 'crypto', dst: null },
            { src: 'blockchain', dst: null },
            { src: 'web3', dst: null },
            { src: 'llm', dst: '–∏–∏' },
            { src: 'prompt', dst: '–∏–∏' },
            { src: 'orchestrator', dst: '–∏–∏' },
            { src: 'analytics', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'scientist', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'science', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'c#', dst: 'csharp' },
            { src: 'c++', dst: 'cpp' },
            { src: 'of', dst: null },
            { src: 'and', dst: null },
            { src: 'in', dst: null },
            { src: 'for', dst: null },
            { src: 'with', dst: null },
            { src: '–≥—Ä—É–ø–ø—ã', dst: null },
            { src: '–∫–æ–º–∞–Ω–¥—ã', dst: null },
            { src: '–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è', dst: null },
            { src: '–æ—Ç–¥–µ–ª–∞', dst: null },
            { src: '—Å–µ–∫—Ç–æ—Ä–∞', dst: null },
            { src: '—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', dst: null },
            { src: '—Ñ—É–Ω–∫—Ü–∏–∏', dst: null },
            { src: '–ø—Ä–∞–∫—Ç–∏–∫–∏', dst: null },
            { src: '—Ü–µ–Ω—Ç—Ä–∞', dst: null },
            { src: 'central', dst: null },
            { src: 'center', dst: null },
            { src: 'global', dst: null },
            { src: 'local', dst: null },
            { src: 'regional', dst: null },
            { src: 'area', dst: null },
            { src: 'chief', dst: null },
            { src: 'officer', dst: null },
            { src: 'development', dst: null },
            { src: 'management', dst: null },
            { src: 'controller', dst: null },
            { src: 'associate', dst: null },
            { src: 'assistant', dst: null },
            { src: '–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç', dst: null },
            { src: '–ø–æ–º–æ—â–Ω–∏–∫', dst: null },
            { src: '—Å—Ç–∞–∂–µ—Ä', dst: null },
            { src: 'intern', dst: null },
            { src: 'trainee', dst: null },
            { src: '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏', dst: null },
            { src: '–ø—Ä–æ–µ–∫—Ç–∞–º–∏', dst: null },
            { src: '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö', dst: null },
            { src: '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π', dst: null },
            { src: 'it', dst: null },
            { src: '–∏—Ç', dst: null },

            // Local synonyms merged
            { src: 'uxui', dst: '–¥–∏–∑–∞–π–Ω–µ—Ä' },
            { src: 'ux', dst: '–¥–∏–∑–∞–π–Ω–µ—Ä' },
            { src: 'ui', dst: '–¥–∏–∑–∞–π–Ω–µ—Ä' },
            { src: 'sa', dst: '—Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'ba', dst: '–±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: '—Å–∞', dst: '—Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: '–±–∞', dst: '–±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'be', dst: 'backend' },
            { src: 'fe', dst: 'frontend' },
            { src: 'do', dst: 'devops' },
            { src: 'qa', dst: '—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫' },
            { src: 'developer', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: 'engineer', dst: '–∏–Ω–∂–µ–Ω–µ—Ä' },
            { src: 'analyst', dst: '–∞–Ω–∞–ª–∏—Ç–∏–∫' },
            { src: 'scrum', dst: '—Å–∫—Ä–∞–º' },
            { src: 'master', dst: '–º–∞—Å—Ç–µ—Ä' },
            { src: 'backend', dst: '–±—ç–∫–µ–Ω–¥' },
            { src: 'frontend', dst: '—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥' },
            { src: 'fullstack', dst: '—Ñ—É–ª–ª—Å—Ç–µ–∫' },
            { src: 'mobile', dst: '–º–æ–±–∏–ª—å–Ω—ã–π' },
            { src: 'ios', dst: '–∏–æ—Å' },
            { src: 'android', dst: '–∞–Ω–¥—Ä–æ–∏–¥' },
            { src: 'scientist', dst: '—Å–∞–π–µ–Ω—Ç–∏—Å—Ç' },
            { src: 'data', dst: '–¥–∞—Ç–∞' },
            { src: 'architect', dst: '–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä' },
            { src: 'lead', dst: '–ª–∏–¥' },
            { src: 'manager', dst: '–º–µ–Ω–µ–¥–∂–µ—Ä' },
            { src: 'owner', dst: '–æ–≤–Ω–µ—Ä' },
            { src: '—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', dst: '—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫' },
            { src: '–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ', dst: '–Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π' },
            { src: '—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ', dst: '—Ä—É—á–Ω–æ–π' },
            { src: '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
            { src: '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç', dst: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
        ];

        const weightsData: WordWeight[] = [
            { word: 'frontend', weight: 0.5 },
            { word: 'backend', weight: 0.5 },
            { word: 'react', weight: 1.2 },
            { word: 'angular', weight: 1.2 },
            { word: 'vue', weight: 1.2 },
            { word: 'qa', weight: 2.0 },
            { word: '–∞–≤—Ç–æ', weight: 1.8 },
            { word: 'java', weight: 1.2 },
            { word: 'python', weight: 1.2 },
            { word: 'javascript', weight: 2.0 },
            { word: 'csharp', weight: 2.0 },
            { word: 'cpp', weight: 2.0 },
            { word: 'php', weight: 1.2 },
            { word: 'go', weight: 2.0 },
            { word: 'kotlin', weight: 2.0 },
            { word: 'swift', weight: 2.0 },
            { word: 'sql', weight: 2.0 },
            { word: 'sap', weight: 2.0 },
            { word: '1—Å', weight: 1.0 },
            { word: '–∏–∏', weight: 2.0 },
            { word: 'data', weight: 1.5 },
            { word: 'dwh', weight: 1.5 },
            { word: 'bi', weight: 1.5 },
            { word: 'developer', weight: 0.3 },
            { word: 'engineer', weight: 0.3 },
            { word: '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', weight: 0.3 },
            { word: '–∏–Ω–∂–µ–Ω–µ—Ä', weight: 0.3 },
            { word: '–º–µ–Ω–µ–¥–∂–µ—Ä', weight: 0.3 },
            { word: '—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', weight: 0.8 },
            { word: '–∞–Ω–∞–ª–∏—Ç–∏–∫', weight: 0.3 },
            { word: '–¥–∏–∑–∞–π–Ω–µ—Ä', weight: 0.3 },
            { word: '—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫', weight: 0.3 },
            { word: '–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', weight: 0.3 },
            { word: '–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç', weight: 0.2 },
            { word: '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', weight: 0.3 },
            { word: '—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç', weight: 0.1 },
            { word: '–ª–∏–¥', weight: 0.3 },
            { word: 'devops', weight: 2.5 },
            { word: 'scrum', weight: 2.5 },
            { word: 'jira', weight: 1.5 },
            { word: 'etl', weight: 1.5 },
        ];

        const stopWords = [
            '–≤', '–Ω–∞', '—Å', '–∫', '–ø–æ', '–∏–∑', '–æ—Ç', '–¥–æ', '—É', '–æ', '–æ–±', '–∑–∞', '–Ω–∞–¥', '–ø–æ–¥', '–ø—Ä–∏', '–¥–ª—è',
            '–∏', '–∞', '–Ω–æ', '–¥–∞', '–∏–ª–∏', '–∫–∞–∫', '—Ç–∞–∫', '—á—Ç–æ', '—á—Ç–æ–±—ã', '–µ—Å–ª–∏', '—Ö–æ—Ç—è', '–Ω–µ', '–Ω–∏', '–∂–µ', '–ª–∏',
            'senior', 'middle', 'junior', 'lead', 'tech', 'team', 'lead', 'senior+', 'middle+', 'junior+',
            'üÜî', 'redlab', 'mts', 'digital', '–º—Ç—Å', '–¥–∏–¥–∂–∏—Ç–∞–ª', '–ª–µ–º–∞–Ω–∞–ø—Ä–æ', 'x5', '–≤–∫', 'vk', '–∫—Ä–æ–∫', 'itfb',
            'the', 'a', 'an', 'of', 'for', 'to', 'in', 'on', 'at', 'by', 'with', '–ø—Ä–æ–µ–∫—Ç', '–ø—Ä–æ–µ–∫—Ç–∞', '–ø—Ä–æ–µ–∫—Ç–µ',
            '–Ω–æ–º–µ—Ä', '–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏', 'id', '–ø2026', 'üÜî', '–∫–æ–ª–ª–µ–≥–∏', '–≤—Å–µ–º', '–ø—Ä–∏–≤–µ—Ç', '–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ', '–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏',
        ];

        return new SpecializationsMatchingEngine(
            specNames,
            synonymsData,
            weightsData,
            stopWords
        );
    }
}
